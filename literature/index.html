<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Literature — Sub Gallery</title>

  <!-- Match your homepage stack -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    
    /* Keep the look consistent with your homepage cards */
    body { font-family: 'Inter', sans-serif; background:#f3f4f6; color:#333; }

    /* Wrapper: cards (left) + preview (right) */
    #subwrap { display:grid; grid-template-columns: 1fr 0; gap: 1rem; transition: grid-template-columns .25s ease; }
    #subwrap.open { grid-template-columns: 1fr min(520px, 40vw); }

    /* Preview panel — switch from grid to flex for reliable full-height iframe */
#preview{
  border-left: 1px solid #e9e9e9; background:#fff;
  height: 100vh; position: sticky; top: 0;
  display: flex; flex-direction: column;
  border-radius: 0.5rem; overflow: hidden;
}

/* Header stays at natural height */
#pv-head {
  display: flex;
  align-items: center;
  justify-content: space-between; /* pushes items to opposite sides */
  padding: 10px 12px;
  border-bottom: 1px solid #e9e9e9;
  background: #fafafa;
}
/* Placeholder occupies remaining height until an item is opened */
#pv-placeholder{
  flex: 1 1 auto;
  display:flex; align-items:center; justify-content:center;
  color:#666; font-size:.95rem; padding: 8px 12px;
}

/* The iframe should fill the entire remaining panel height */
#pv-frame{
  display:none;           /* hidden until 'showing-iframe' */
  width:100%;
  height:auto;
  flex: 1 1 auto;         /* <— makes it fill the panel */
  background:#fff; border:0;
  min-height:0;           /* defensive: allow it to grow inside flex */
}

/* Toggle states */
#preview.showing-placeholder #pv-frame{ display:none; }
#preview.showing-iframe #pv-placeholder{ display:none; }
#preview.showing-iframe #pv-frame{ display:block; }

/* On mobile, keep your existing drawer behavior */
@media (max-width: 900px){
  #subwrap{ grid-template-columns: 1fr; }
  #subwrap.open{ grid-template-columns: 1fr; }
  #preview{ position: fixed; inset: 0; z-index: 50; display:none; }
  #subwrap.open #preview{ display:flex; }
}

    /* Your existing gallery card look (reused) */
    .gallery-item {
      width: 150px; height: 150px; border-radius: 0.5rem; overflow: hidden;
      flex-shrink: 0; display: flex; flex-direction: column; justify-content: flex-end;
      position: relative; transition: transform 0.2s ease-in-out; cursor: pointer;
      background:#e5e7eb; /* gray-200 */
    }
    .gallery-item:hover { transform: scale(1.05); }
    .gallery-item-frame { border: 10px solid #fff; border-radius: 0.9rem; position: relative; width: 100%; height: 100%; overflow: hidden; }
    .gallery-item-frame img { width:100%; height:100%; object-fit:cover; }
    .gallery-item-title {
      position:absolute; left:0; right:0; bottom:0; background:rgba(0,0,0,.7);
      color:#fff; padding:.5rem; text-align:center; font-size:.875rem; opacity:0; transition:opacity .3s;
    }
    .gallery-item:hover .gallery-item-title { opacity:1; }

    /* Sticky nav offsets, keyboard hover parity (like homepage) */
    section[id] { scroll-margin-top: 88px; }
    .gallery-item:focus .gallery-item-title,
    .gallery-item:focus-within .gallery-item-title { opacity:1; outline:none; }
    .gallery-item:focus-visible { box-shadow: 0 0 0 3px rgba(59,130,246,.6); border-radius:.5rem; }
  </style>
</head>
<body class="bg-gray-100">
    <div id="navbar"></div>
    <script src="../assets/nav-inject.js" defer></script>
  <!-- Simple header to match your homepage tone -->
  <header class="bg-white border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <h1 class="text-3xl font-bold text-gray-800">Literature</h1>
      <p class="text-gray-600 mt-1">Browse and preview entries before opening the full page.</p>
    </div>
  </header>

  <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <!-- Wrapper: left cards + right preview -->
    <div id="subwrap" data-json="../assets/literature.json">
      <!-- Cards -->
      <section id="cards" class="flex flex-wrap gap-4" aria-label="Literature items"></section>

      <!-- Preview panel -->
      <aside id="preview" aria-hidden="true" role="dialog" aria-labelledby="pv-title">
        <div id="pv-head">
          <a id="open-full" target="_blank" rel="noopener">Open full page ↗</a>
          <button id="close-preview" type="button" aria-label="Close preview">Close</button>
        </div>
        <div id="pv-placeholder"><p>Click on an item to preview it here</p></div>
        <iframe id="pv-frame" title="Item preview" loading="lazy" referrerpolicy="no-referrer"></iframe>
      </aside>
    </div>

    <noscript>
      <p class="mt-4 text-sm text-gray-600">Enable JavaScript to view in-page previews. All items are still accessible via their links.</p>
    </noscript>
  </main>

  <!-- One inline script to do everything -->
 <script>
(function(){
  const subwrap   = document.getElementById('subwrap');
  const cards     = document.getElementById('cards');
  const preview   = document.getElementById('preview');
  const frame     = document.getElementById('pv-frame');
  const openBtn   = document.getElementById('open-full');
  const titleEl   = document.getElementById('pv-title');
  const closeBtn  = document.getElementById('close-preview');

  const jsonPath  = subwrap.getAttribute('data-json');           // ../assets/literature.json
  const baseDir   = location.pathname.replace(/\/[^\/]*$/, '/'); // current folder (/.../literature/)
  const hrefFor   = (rel) => new URL((rel||'').replace(/^\//,''), location.origin + baseDir).href;

  function renderCard(it, i){
    const thumb = it.thumb
      ? `<img src="${hrefFor(it.thumb)}" alt="" loading="lazy">`
      : `<div aria-hidden="true" style="width:100%;height:100%;background:#e5e7eb;"></div>`;
    return `
      <article class="gallery-item shadow-lg relative" data-index="${i}" tabindex="0" aria-haspopup="dialog" style="width:150px; height:150px;">
        <div class="gallery-item-frame">${thumb}</div>
        <div class="gallery-item-title">${it.title || 'Untitled'}</div>
      </article>`;
  }

  function renderCards(list){
    cards.innerHTML = list.map(renderCard).join('');

    // Click / keyboard activation
    cards.querySelectorAll('.gallery-item').forEach(el => {
      const idx = +el.getAttribute('data-index');
      el.addEventListener('click', () => openPreview(list[idx]));
      el.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openPreview(list[idx]); }
      });
    });

    // Deep-link support: ?preview=filename.html
    const want = new URLSearchParams(location.search).get('preview');
    if (want) {
      const item = list.find(x => (x.path || '').replace(/^\.\//,'') === want.replace(/^\.\//,''));
      if (item) openPreview(item, false);
    }
  }

  function openPreview(item, pushState = true){
    subwrap.classList.add('open');                        // show panel / allocate width
    preview.classList.remove('showing-placeholder');
    preview.classList.add('showing-iframe');

    const url = hrefFor(item.path);
    frame.src = url;
    openBtn.href = url;

    preview.setAttribute('aria-hidden', 'false');

    if (pushState) {
      const u = new URL(location.href);
      u.searchParams.set('preview', (item.path || '').replace(/^\.\//,''));
      history.pushState({ preview: item.path }, '', u);
    }
    closeBtn.focus();
  }

  function closePreview(){
    subwrap.classList.remove('open');
    preview.classList.remove('showing-iframe');
    preview.classList.add('showing-placeholder');
    frame.removeAttribute('src');
    preview.setAttribute('aria-hidden', 'true');
    const u = new URL(location.href);
    u.searchParams.delete('preview');
    history.pushState({}, '', u);
    cards.querySelector('.gallery-item')?.focus();
  }

  closeBtn.addEventListener('click', closePreview);
  window.addEventListener('keydown', (e) => { if (e.key === 'Escape') closePreview(); });
  window.addEventListener('popstate', () => {
    const want = new URL(location.href).searchParams.get('preview');
    if (!want) closePreview();
  });

  // Load the section list (JSON paths must be folder-relative for GH Pages)
  fetch(jsonPath, { cache: 'no-store' })
    .then(r => { if (!r.ok) throw new Error('HTTP '+r.status); return r.json(); })
    .then(renderCards)
    .catch(err => {
      console.error('Failed to load list', err);
      cards.innerHTML = `<p class="text-gray-600">Could not load list. Check <code>${jsonPath}</code> path.</p>`;
    });
})();
</script>

</body>
</html>
